local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CommF = ReplicatedStorage.Remotes.CommF_

-- Variables
local JOBID = ""
local TARGET_SEA = "2"

local SEA_PLACE = {
    ["1"] = 2753915549,
    ["2"] = 4442272183,
    ["3"] = 7449423635,
}

local FRUITS = {
    "dragon", "kitsune", "dough", "venom", "leopard", "spirit", "control", "shadow",
    "quake", "buddha", "rumble", "portal", "phoenix", "gravity", "blizzard", "love"
}

local function getCurrentSea()
    if game.PlaceId == 2753915549 then
        return "1"
    elseif game.PlaceId == 4442272183 then
        return "2"
    elseif game.PlaceId == 7449423635 then
        return "3"
    end
    return "0"
end

-- Command Execution Function
local function executeCommand(command)
    local ChatService = ReplicatedStorage:FindFirstChild("DefaultChatSystemChatEvents")
    
    if ChatService then
        local SayMessageRequest = ChatService:FindFirstChild("SayMessageRequest")
        if SayMessageRequest then
            SayMessageRequest:FireServer(command, "All")
            print("Executed command:", command)
        end
    else
        -- Alternative method using chat
        game:GetService("Players").LocalPlayer:GetMouse().KeyDown:Connect(function(key)
            if key == " " then
                -- Fallback if chat service not found
                game:GetService("Players").LocalPlayer:Kick("Chat service not found!")
            end
        end)
    end
end

local function createCommandGUI()
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "CommandGUI"
    ScreenGui.Parent = Players.LocalPlayer:WaitForChild("PlayerGui")
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    local MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Size = UDim2.new(0, 850, 0, 500)
    MainFrame.Position = UDim2.new(0.5, -425, 0.5, -250)
    MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    MainFrame.BorderSizePixel = 0
    MainFrame.Parent = ScreenGui
    
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 12)
    UICorner.Parent = MainFrame
    
    local TopBar = Instance.new("Frame")
    TopBar.Size = UDim2.new(1, 0, 0, 50)
    TopBar.Position = UDim2.new(0, 0, 0, 0)
    TopBar.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
    TopBar.Parent = MainFrame
    
    local TopCorner = Instance.new("UICorner")
    TopCorner.CornerRadius = UDim.new(0, 12)
    TopCorner.Parent = TopBar
    
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, 0, 1, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "COMMAND CONTROL PANEL"
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 20
    Title.Parent = TopBar
    
    local CloseButton = Instance.new("TextButton")
    CloseButton.Size = UDim2.new(0, 30, 0, 30)
    CloseButton.Position = UDim2.new(1, -35, 0.5, -15)
    CloseButton.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
    CloseButton.Text = "X"
    CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    CloseButton.Font = Enum.Font.GothamBold
    CloseButton.TextSize = 16
    CloseButton.Parent = TopBar
    
    local CloseCorner = Instance.new("UICorner")
    CloseCorner.CornerRadius = UDim.new(0, 6)
    CloseCorner.Parent = CloseButton
    
    -- TAB SYSTEM
    local TabFrame = Instance.new("Frame")
    TabFrame.Size = UDim2.new(1, -20, 0, 40)
    TabFrame.Position = UDim2.new(0, 10, 0, 60)
    TabFrame.BackgroundTransparency = 1
    TabFrame.Parent = MainFrame
    
    local FruitTab = Instance.new("TextButton")
    FruitTab.Size = UDim2.new(0.33, 0, 1, 0)
    FruitTab.Position = UDim2.new(0, 0, 0, 0)
    FruitTab.BackgroundColor3 = Color3.fromRGB(45, 45, 65)
    FruitTab.Text = "FRUIT COMMANDS"
    FruitTab.TextColor3 = Color3.fromRGB(255, 255, 255)
    FruitTab.Font = Enum.Font.GothamBold
    FruitTab.TextSize = 14
    FruitTab.Parent = TabFrame
    
    local TradeTab = Instance.new("TextButton")
    TradeTab.Size = UDim2.new(0.33, 0, 1, 0)
    TradeTab.Position = UDim2.new(0.33, 0, 0, 0)
    TradeTab.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
    TradeTab.Text = "TRADE COMMANDS"
    TradeTab.TextColor3 = Color3.fromRGB(200, 200, 200)
    TradeTab.Font = Enum.Font.GothamBold
    TradeTab.TextSize = 14
    TradeTab.Parent = TabFrame
    
    local ControlTab = Instance.new("TextButton")
    ControlTab.Size = UDim2.new(0.34, 0, 1, 0)
    ControlTab.Position = UDim2.new(0.66, 0, 0, 0)
    ControlTab.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
    ControlTab.Text = "CONTROL COMMANDS"
    ControlTab.TextColor3 = Color3.fromRGB(200, 200, 200)
    ControlTab.Font = Enum.Font.GothamBold
    ControlTab.TextSize = 14
    ControlTab.Parent = TabFrame
    
    local TabCorner = Instance.new("UICorner")
    TabCorner.CornerRadius = UDim.new(0, 6)
    TabCorner.Parent = FruitTab
    TabCorner:Clone().Parent = TradeTab
    TabCorner:Clone().Parent = ControlTab
    
    -- CONTENT FRAME
    local ContentFrame = Instance.new("Frame")
    ContentFrame.Size = UDim2.new(1, -20, 1, -120)
    ContentFrame.Position = UDim2.new(0, 10, 0, 110)
    ContentFrame.BackgroundTransparency = 1
    ContentFrame.Parent = MainFrame
    
    -- FRUIT COMMANDS TAB
    local FruitFrame = Instance.new("ScrollingFrame")
    FruitFrame.Size = UDim2.new(1, 0, 1, 0)
    FruitFrame.BackgroundTransparency = 1
    FruitFrame.ScrollBarThickness = 6
    FruitFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
    FruitFrame.Visible = true
    FruitFrame.Parent = ContentFrame
    
    local FruitGrid = Instance.new("UIGridLayout")
    FruitGrid.CellSize = UDim2.new(0.48, 0, 0, 40)
    FruitGrid.CellPadding = UDim2.new(0, 5, 0, 5)
    FruitGrid.StartCorner = Enum.StartCorner.TopLeft
    FruitGrid.Parent = FruitFrame
    
    -- Add Fruit Buttons
    for _, fruit in pairs(FRUITS) do
        -- Add Button
        local AddButton = Instance.new("TextButton")
        AddButton.Size = UDim2.new(1, 0, 0, 40)
        AddButton.BackgroundColor3 = Color3.fromRGB(60, 180, 60)
        AddButton.Text = "+" .. fruit:upper()
        AddButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        AddButton.Font = Enum.Font.GothamBold
        AddButton.TextSize = 14
        AddButton.Parent = FruitFrame
        
        local ButtonCorner = Instance.new("UICorner")
        ButtonCorner.CornerRadius = UDim.new(0, 6)
        ButtonCorner.Parent = AddButton
        
        AddButton.MouseButton1Click:Connect(function()
            executeCommand("+" .. fruit)
        end)
        
        -- Remove Button
        local RemoveButton = Instance.new("TextButton")
        RemoveButton.Size = UDim2.new(1, 0, 0, 40)
        RemoveButton.BackgroundColor3 = Color3.fromRGB(180, 60, 60)
        RemoveButton.Text = "-" .. fruit:upper()
        RemoveButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        RemoveButton.Font = Enum.Font.GothamBold
        RemoveButton.TextSize = 14
        RemoveButton.Parent = FruitFrame
        
        local RemoveCorner = Instance.new("UICorner")
        RemoveCorner.CornerRadius = UDim.new(0, 6)
        RemoveCorner.Parent = RemoveButton
        
        RemoveButton.MouseButton1Click:Connect(function()
            executeCommand("-" .. fruit)
        end)
    end
    
    -- TRADE COMMANDS TAB
    local TradeFrame = Instance.new("ScrollingFrame")
    TradeFrame.Size = UDim2.new(1, 0, 1, 0)
    TradeFrame.BackgroundTransparency = 1
    TradeFrame.ScrollBarThickness = 6
    TradeFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
    TradeFrame.Visible = false
    TradeFrame.Parent = ContentFrame
    
    local TradeGrid = Instance.new("UIGridLayout")
    TradeGrid.CellSize = UDim2.new(1, 0, 0, 45)
    TradeGrid.CellPadding = UDim2.new(0, 0, 0, 5)
    TradeGrid.StartCorner = Enum.StartCorner.TopLeft
    TradeGrid.Parent = TradeFrame
    
    local TradeCommands = {
        {name = "ACCEPT TRADE", command = "?accept", color = Color3.fromRGB(0, 170, 255)}
    }
    
    for _, cmd in pairs(TradeCommands) do
        local CommandButton = Instance.new("TextButton")
        CommandButton.Size = UDim2.new(1, 0, 0, 45)
        CommandButton.BackgroundColor3 = cmd.color
        CommandButton.Text = cmd.name
        CommandButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        CommandButton.Font = Enum.Font.GothamBold
        CommandButton.TextSize = 16
        CommandButton.Parent = TradeFrame
        
        local CommandCorner = Instance.new("UICorner")
        CommandCorner.CornerRadius = UDim.new(0, 8)
        CommandCorner.Parent = CommandButton
        
        CommandButton.MouseButton1Click:Connect(function()
            executeCommand(cmd.command)
        end)
    end
    
    -- CONTROL COMMANDS TAB
    local ControlFrame = Instance.new("ScrollingFrame")
    ControlFrame.Size = UDim2.new(1, 0, 1, 0)
    ControlFrame.BackgroundTransparency = 1
    ControlFrame.ScrollBarThickness = 6
    ControlFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
    ControlFrame.Visible = false
    ControlFrame.Parent = ContentFrame
    
    local ControlGrid = Instance.new("UIGridLayout")
    ControlGrid.CellSize = UDim2.new(1, 0, 0, 45)
    ControlGrid.CellPadding = UDim2.new(0, 0, 0, 5)
    ControlGrid.StartCorner = Enum.StartCorner.TopLeft
    ControlGrid.Parent = ControlFrame
    
    local ControlCommands = {
        {name = "JUMP", command = "?jump", color = Color3.fromRGB(255, 140, 0)},
        {name = "TELEPORT TO ME", command = "?tp", color = Color3.fromRGB(255, 140, 0)},
        {name = "TEST RESPONSIVENESS", command = "?test", color = Color3.fromRGB(255, 140, 0)}
    }
    
    for _, cmd in pairs(ControlCommands) do
        local CommandButton = Instance.new("TextButton")
        CommandButton.Size = UDim2.new(1, 0, 0, 45)
        CommandButton.BackgroundColor3 = cmd.color
        CommandButton.Text = cmd.name
        CommandButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        CommandButton.Font = Enum.Font.GothamBold
        CommandButton.TextSize = 16
        CommandButton.Parent = ControlFrame
        
        local CommandCorner = Instance.new("UICorner")
        CommandCorner.CornerRadius = UDim.new(0, 8)
        CommandCorner.Parent = CommandButton
        
        CommandButton.MouseButton1Click:Connect(function()
            executeCommand(cmd.command)
        end)
    end
    
    -- RESET FRUIT SECTION
    local ResetLabel = Instance.new("TextLabel")
    ResetLabel.Size = UDim2.new(1, 0, 0, 30)
    ResetLabel.Position = UDim2.new(0, 0, 0, 150)
    ResetLabel.BackgroundTransparency = 1
    ResetLabel.Text = "RESET WITH FRUIT:"
    ResetLabel.TextColor3 = Color3.fromRGB(200, 200, 255)
    ResetLabel.Font = Enum.Font.GothamBold
    ResetLabel.TextSize = 14
    ResetLabel.TextXAlignment = Enum.TextXAlignment.Left
    ResetLabel.Parent = ControlFrame
    
    local ResetGrid = Instance.new("UIGridLayout")
    ResetGrid.CellSize = UDim2.new(0.33, 0, 0, 35)
    ResetGrid.CellPadding = UDim2.new(0, 5, 0, 5)
    ResetGrid.StartCorner = Enum.StartCorner.TopLeft
    ResetGrid.Parent = ControlFrame
    
    local ResetFruits = {"dragon", "kitsune", "dough", "venom", "leopard", "spirit"}
    
    for _, fruit in pairs(ResetFruits) do
        local ResetButton = Instance.new("TextButton")
        ResetButton.Size = UDim2.new(1, 0, 0, 35)
        ResetButton.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
        ResetButton.Text = "RESET " .. fruit:upper()
        ResetButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        ResetButton.Font = Enum.Font.GothamBold
        ResetButton.TextSize = 12
        ResetButton.Parent = ControlFrame
        
        local ResetCorner = Instance.new("UICorner")
        ResetCorner.CornerRadius = UDim.new(0, 6)
        ResetCorner.Parent = ResetButton
        
        ResetButton.MouseButton1Click:Connect(function()
            executeCommand("?reset " .. fruit)
        end)
    end
    
    -- TAB SWITCHING
    FruitTab.MouseButton1Click:Connect(function()
        FruitTab.BackgroundColor3 = Color3.fromRGB(45, 45, 65)
        FruitTab.TextColor3 = Color3.fromRGB(255, 255, 255)
        TradeTab.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
        TradeTab.TextColor3 = Color3.fromRGB(200, 200, 200)
        ControlTab.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
        ControlTab.TextColor3 = Color3.fromRGB(200, 200, 200)
        
        FruitFrame.Visible = true
        TradeFrame.Visible = false
        ControlFrame.Visible = false
    end)
    
    TradeTab.MouseButton1Click:Connect(function()
        TradeTab.BackgroundColor3 = Color3.fromRGB(45, 45, 65)
        TradeTab.TextColor3 = Color3.fromRGB(255, 255, 255)
        FruitTab.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
        FruitTab.TextColor3 = Color3.fromRGB(200, 200, 200)
        ControlTab.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
        ControlTab.TextColor3 = Color3.fromRGB(200, 200, 200)
        
        FruitFrame.Visible = false
        TradeFrame.Visible = true
        ControlFrame.Visible = false
    end)
    
    ControlTab.MouseButton1Click:Connect(function()
        ControlTab.BackgroundColor3 = Color3.fromRGB(45, 45, 65)
        ControlTab.TextColor3 = Color3.fromRGB(255, 255, 255)
        FruitTab.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
        FruitTab.TextColor3 = Color3.fromRGB(200, 200, 200)
        TradeTab.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
        TradeTab.TextColor3 = Color3.fromRGB(200, 200, 200)
        
        FruitFrame.Visible = false
        TradeFrame.Visible = false
        ControlFrame.Visible = true
    end)
    
    -- CLOSE BUTTON
    CloseButton.MouseButton1Click:Connect(function()
        ScreenGui:Destroy()
    end)
    
    -- AUTO-SHOW GUI WHEN TELEPORTED
    print("Command GUI loaded successfully!")
end

-- Main teleport function
local function teleportToServer()
    local TARGET_PLACE = SEA_PLACE[TARGET_SEA]
    if not TARGET_PLACE then
        Players.LocalPlayer:Kick("Invalid SEA config!")
        return
    end
    
    if not JOBID or JOBID == "" then
        Players.LocalPlayer:Kick("Invalid or missing JobId!")
        return
    end
    
    local CURRENT_SEA = getCurrentSea()
    
    -- Queue for reconnection
    queue_on_teleport(string.format([[
        task.wait(4)
        if game.PlaceId == %s and game.JobId ~= "%s" then
            game:GetService("TeleportService"):TeleportToPlaceInstance(%s, "%s")
        end
    ]], TARGET_PLACE, JOBID, TARGET_PLACE, JOBID))
    
    -- Handle SEA travel
    if CURRENT_SEA ~= TARGET_SEA then
        if CURRENT_SEA == "1" then
            CommF:InvokeServer("TravelDressrosa")
            return
        end
        
        if CURRENT_SEA == "2" and TARGET_SEA == "3" then
            CommF:InvokeServer("TravelZou")
            return
        end
    end
    
    -- Direct teleport if already in correct SEA
    if game.PlaceId == TARGET_PLACE and game.JobId ~= JOBID then
        TeleportService:TeleportToPlaceInstance(TARGET_PLACE, JOBID)
    end
end

-- AUTO-SHOW GUI AFTER TELEPORT
task.wait(5) -- Wait for game to load
createCommandGUI()
